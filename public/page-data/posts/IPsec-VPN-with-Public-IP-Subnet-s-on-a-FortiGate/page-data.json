{"componentChunkName":"component---src-templates-post-template-jsx","path":"/posts/IPsec-VPN-with-Public-IP-Subnet-s-on-a-FortiGate","result":{"data":{"site":{"siteMetadata":{"title":"Blog by Sam Perrin","subtitle":"Automation Consultant, currently working at Xtravirt. Interested in all things automation/devops related.","copyright":"© All rights reserved.","author":{"name":"Sam Perrin","twitter":"sam_perrin"},"disqusShortname":"","url":"https://samperrin.netlify.com"}},"markdownRemark":{"id":"0c8acdef-be88-59ba-b2d8-4ad75bbd52f8","html":"<p>I recently came across a requirement where I had to create a site-to-site IPsec VPN, this is usually not an issue, set your Phase 1 and Phase 2 settings, apply your policies and you are good to go, but the difference this time was those local and remote subnets were Public IP addresses.<br>\nThe Public IP address our side was also being used as a VIP</p>\n<p>Below I will document the steps in getting this working – the issue I had was where I put my policies, and not enabling NAT on the outgoing policy!</p>\n<h3>Create your IPsec tunnel;</h3>\n<p><em>FortiGate GUI > VPN > IPsec > Tunnels > Create New</em></p>\n<ul>\n<li>Set your name and chose your template. I used “Custom VPN Tunnel (No Template)”</li>\n<li>Fill in your Phase1 settings</li>\n<li>\n<p>Fill in your Phase2 settings;</p>\n<ul>\n<li>Local Subnet – this will be your Public IP/Range</li>\n<li>Remote Subnet – this will be their Public IP/Range</li>\n</ul>\n</li>\n<li>Press OK to create the tunnel</li>\n</ul>\n<h3>Add in your new route;</h3>\n<p><em>FortiGate GUI > Router > Static Routes > Create New</em></p>\n<ul>\n<li>Destination IP/Mask – this will be the Remote Subnet you entered for your Phase2</li>\n<li>Device – this will be the tunnel you have just created</li>\n<li>Change any of the other settings if you need to</li>\n<li>OK to add the new route</li>\n</ul>\n<h3>Create an IP Pool;</h3>\n<p><em>FortiGate GUI > Policy &#x26; Objects > Objects > IP Pools > Create New</em></p>\n<ul>\n<li>Add a name and comments if required, and set the type (I am using Overload)</li>\n<li>External IP Range = the range you set for Local Subnet</li>\n<li>Ok to create the IP Pool</li>\n</ul>\n<h3>Create your policies;</h3>\n<p><em>FortiGate GUI > Policy &#x26; Objects > Policy > IPv4 > Create New</em></p>\n<p><strong><em>Outgoing</em></strong></p>\n<ul>\n<li>Incoming Interface = The internal interface where your server exists</li>\n<li>Source Address = An object with the internal IP address of your server</li>\n<li>Outgoing Interface = The tunnel you just made</li>\n<li>Destination Address = An object with the remote Public IP range</li>\n<li>Apply any Schedules and Service restrictions and Action = Accept</li>\n</ul>\n<p>You now need to enable NAT, this is the bit I missed at first;</p>\n<ul>\n<li><strong>NAT = On</strong></li>\n<li>Use Dynamic IP Pool = Select the pool you made in the previous step</li>\n<li>Add any other settings and then OK to create your first policy</li>\n</ul>\n<p><strong><em>Incoming</em></strong></p>\n<ul>\n<li>Create the second policy for Tunnel to Internal</li>\n<li>Incoming Interface = The tunnel you just made</li>\n<li>Source Address = An object with the remote Public IP range</li>\n<li>Outgoing Interface = The internal interface where your server exists</li>\n<li>Destination Address = The VIP that belongs to the internal server (same as the IP Pool address)</li>\n<li>Apply any Schedules and Service restrictions and Action = Accept</li>\n</ul>\n<p>On this policy you <strong>do not need</strong> NAT</p>\n<ul>\n<li><strong>NAT = Off</strong></li>\n<li>Add any other settings and then OK to create your first policy</li>\n</ul>\n<p>Check to see if your Tunnel is Up and try sending some traffic down it<br>\n<em>FortiGate GUI > VPN > Monitor > IPsec Monitor</em></p>\n<p><img src=\"outgoing.png\"></p>\n<p><img src=\"incoming.png\"></p>","fields":{"tagSlugs":["/tags/development/"],"slug":"/posts/IPsec-VPN-with-Public-IP-Subnet-s-on-a-FortiGate"},"frontmatter":{"title":"IPsec VPN with Public IP Subnet’s on a FortiGate","tags":["development"],"date":"2015-06-23T14:15:30.150Z","description":"IPsec VPN with Public IP Subnet’s on a FortiGate"}}},"pageContext":{"slug":"/posts/IPsec-VPN-with-Public-IP-Subnet-s-on-a-FortiGate"}}}