{"componentChunkName":"component---src-templates-post-template-jsx","path":"/posts/EqualLogic-PS4100-and-ESXi-5-5-VMkernel-Setup","result":{"data":{"site":{"siteMetadata":{"title":"Blog by Sam Perrin","subtitle":"Automation Consultant, currently working at Xtravirt. Interested in all things automation/devops related.","copyright":"© All rights reserved.","author":{"name":"Sam Perrin","twitter":"sam_perrin"},"disqusShortname":"","url":"https://samperrin.netlify.com"}},"markdownRemark":{"id":"8ec2f7ed-e5c8-5cab-bc6d-04129a7a5ccf","html":"<p>Read the first blog post <a href=\"https://samperrin.com/vmware/dell-mem-v1-2-and-esxi-5-5-u2/\" title=\"Dell MEM v1.2 and ESXi 5.5 U2\">here</a> about Dell MEM and ESXi 5.5</p>\n<p>As part of the EqualLogic MEM setup.pl script it creates a new vSwitch and also its iSCSI VMkernel’s, but due to that script not currently being compatible with ESXi 5.5 U2 we had to manually create the connections. Below is the setup we have used and a few differences compared to the Dell EqualLogic best practice document.</p>\n<p>In the document it states that the heartbeat connection is no longer required for ESXi servers of version 5.1 or above. I had issues with this and found that if a switch that one of the adapters connected to failed, the pings would stop to the storage device and ESXi would report that all paths were down for the EqualLogic array, and therefore lose access to the datastore. I added a heartbeat connection in and was able to keep a path active when an adapter failed. Below will cover the settings I have in place and the tests I did to determine successful failover in various scenarios</p>\n<p><code>The Storage Heartbeat VMkernel port is no longer required for ESX servers running version 5.1 and greater</code></p>\n<p><strong>vSwitch Setup</strong></p>\n<ul>\n<li>Create a new Standard VMkernel vSwitch on your host and assign two or more network adapters to it (these are obviously the adapters that connect to your storage network where the EqualLogic sits)</li>\n<li>Name the adapter “EQL Heartbeat”</li>\n<li>Assign an IP to the EQL Heartbeat VMkernel port</li>\n<li>Finish the setup screen</li>\n<li>Find the vSwitch in the Networking window and select Properties</li>\n<li>Add a new VMkernel port to the vSwitch; press Add, select VMkernel, label it EQL_1</li>\n<li>Assign an IP address (same subnet as your heartbeat port), finish the setup</li>\n<li>Repeat the process again and label the new VMkernel EQL_2, again this needs to be in the same subnet as the other two VMkernel ports</li>\n</ul>\n<p>Once you have done that you should have something that looks similar to this;</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/51c0156d41a8bf1ce33599b80853ff38/50ac3/vswitch1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 356px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 38.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAABLklEQVQY03WQaW6DMBCFuf9h2n+9QFMaQRJU9nghsbERWxYKQUrBUGOriqqqn+TRaN48z9iG7/mMc/fDBQDE8X6z2QZBSGnatm3Xde3/NE1jxFEs/Y7j7HaO7/ue58kYx3EURmEQRGGI/gAVeZ4b5vrtdbWyLds017rEOc8yblvWu2lalk0IkRW2kMojc6KoqsrY+l6WF2WRHwm937/meZ6mScZzXaeMS2UYBiHErNCSpu9742XLQXbhlJzOl1E16Y6yKCBElFBCKAQwSY4QgD1AbXd7mJ/svZvynKbVqR5GMU1Cm6uyxOigFubLLZQlGEOU3G79w/xsA5dxJidQiiUId0qu6wrjA2fZYgZQ/j+CCOHf5uvndZzlvkJMYlToyTIuRa2ofBiU9PNsaf4Gju207aQBnLIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"vSwitch Layout\"\n        title=\"\"\n        src=\"/static/51c0156d41a8bf1ce33599b80853ff38/50ac3/vswitch1.png\"\n        srcset=\"/static/51c0156d41a8bf1ce33599b80853ff38/8ff5a/vswitch1.png 240w,\n/static/51c0156d41a8bf1ce33599b80853ff38/50ac3/vswitch1.png 356w\"\n        sizes=\"(max-width: 356px) 100vw, 356px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>We need to make a few more changes to this vSwitch;</p>\n<ul>\n<li>Edit each of the items in the screen shot to have an MTU of 9000 (your switch must also support this!)</li>\n<li>Edit vSwitch > NIC teaming tab, all adapters should be active</li>\n<li>Edit EQL Heartbeat > NIC teaming tab, all adapters should be active (will most likely be grayed out as inherits settings from vSwitch)</li>\n<li>Edit EQL_1 > NIC teaming tab, under Failover Order tick Override switch failover adapter, keep one in Active and move the other to unused</li>\n<li>Edit EQL<em>2 > NIC teaming tab, under Failover Order tick Override switch failover adapter, keep one in Active and move the other to unused – this needs to be different to the one used in EQL</em>1</li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b51c2ec6cb795885ae82b70f077fb2ff/2d920/eql_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 536px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 124.16666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAABYlAAAWJQFJUiTwAAADVUlEQVQ4y5VU2W7bRhTVVxZNYfupf+FPSfvUpyRFgsRIGjoG0tSWZFmUKIsiKe4z3BeRFBfJirUkh1RbCHbXg8vR4OqeuXPPnZnW92c/nDBnR+fM8fn74w/MycX7kwvmiHn75NWL716//PbnZ09ePj9i3h2d/7K3Y+bdNx8vTn98+tPpaevFZNQz9Ctda+vapaZeqeqVVtsnSfxNli/l6SdRhLNHyY1F99azKGdbZ5LYujZNzzBMTdOnU1NVXUo9y4IRTfcsO/Z9h9LI8+6KYlVVd2W5KqtlUW4Wi5Ftta4pQdBEEAVR9IOwLMv5fJ5l8zTLPN+zHcdxXYyEUoIPi9J69BynrSg12SV0NOYnEwF/w6IozvN8Npvpuj6VamBiGAY2RwjBxESQYXQUGWTqEiJKU1GU4EQi0EBOksQ0TcPQkcn1vKhBGIb4/CCwTPN3smOa2HYcx9htWRbzBiAjoW3bIPi+7x3AdV2q6zW5SwlUQRm+54OTHyBJUHi2dx6OcKVR1FWVVhdlKArLDvo3/Vo0FCBNoUmWZkg+i2dpkmJTswbwYI4lyyyryT3bQofYwYDnJxw34oYc22dhw8FQmAimSVzHaYqHGRBM0zRsCC3pqI3aqijd3PQbXSWO425vx7Isi4IwGAzhAZM0wAT1IzMEi4PgWlNRM1Wk8WjMIc713GaTs/v1erVaQV7U/PlP3N8Xee64jmXbgeteaxoyW/J0dCuwiqJiSehRldWuwWKx2G62Xw5QVZXbABrXmdEqWeS7vXa32+kPBnlRbDabbQNMdgcAGcvtBS/2gnVNnAIpTJyqXG53W6wNnRG5220RtllvDjMvl8t984o0rcmXmrbMi/v15g5Y1vjjt54tD7Ber+ulD8kdYgaOg/aixaqqNl0xzL8CpE7TtL42h+QsimzLtqgVBEFRFPnfADkfknHCZn5AqLWPmP8jHpEpCR1nOBzhwvx/MiGx5+G+4tym/wbEPCQv9hflv6GuPMvymqy2LnU9CSNcdxyvxxagmDiGhQ1wYIPGmURRG/e5T+kaL0CWVfP5A8NpmoUh0XU8j55tR3gTbAevBB6HxPOHhLSeCZO+RdvE7DwyaPlRnr5h2Tdsn+F5Zjx+O+J+VRVmwn/gx8/526+mFy9UnsIMDwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"eql 1\"\n        title=\"\"\n        src=\"/static/b51c2ec6cb795885ae82b70f077fb2ff/2d920/eql_1.png\"\n        srcset=\"/static/b51c2ec6cb795885ae82b70f077fb2ff/8ff5a/eql_1.png 240w,\n/static/b51c2ec6cb795885ae82b70f077fb2ff/e85cb/eql_1.png 480w,\n/static/b51c2ec6cb795885ae82b70f077fb2ff/2d920/eql_1.png 536w\"\n        sizes=\"(max-width: 536px) 100vw, 536px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/37ce090fd37a26025b16943df9b87d01/b1cde/eql_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 537px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 123.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAABYlAAAWJQFJUiTwAAADZklEQVQ4y5VUyXLbRhDlR9opS/ecfUt+Jqc4Fy9RuSqKRcl2iYplSSQlAiAJAuQMBvtO7AApkVryQMgVy3a2V12oAWpeL6+70fp+96ft9uutt/vbb9vbB3t4bsH233z364vHO68evXz++NXzrfbuk4O9J/tvYFvt3x+9P3j6y8/Pfvyh9XLIcZraU9W+yrqMnVHaw0FRTqfTM0K6hJzKMj4OTIOzzMYGljm0rY6itI7IzGWqSimVp4xQU1Vd07Q0XaPUNozA9UxNd01rkefLolwWBWxR5Kuqoq7T6ijUtyx+CIxt2ynKMk3TJE3jJHZc+DFt2zZtSzMMTdN0PHVdM3TXdjiF1mTPMIXhSBQlFWDM84Isy+bzOd6kiSTLEtJijOGJL4rC4AWeeEpbR0xxDXMiSZOJpOuG67phOM+yNIoiXFIUBRUgeBAEfuA38Ly6Fl65J+uIHAZhkiR5nqcbgIwsDMPAbXh0HuJTZIXGvo+YKBic/BOQeZLETf3ZQyBGEkUCg9pIjJJer39xMRhBtNFYnEioEJFRdhiGOPh+0ACvnu9HcVzlxZCx1geVmUzp9fvCcMjz/HmNQb/bvzgfCMIICqFgVmukM6ZCaviFKIuiEECuIxMKwnQ6nRECPpo2mxFJlgaDwVgU2YYKsLoRHtKBClEY8hiSDjowFc/5c8iNWygRuV1tgAgo+PLysnm9Wq3KokAilmUFnlcL1qEKI2NO7KOBmIG8yMuivLm5ubu7q6rq+vr67jMsFguQbceZB8FGMEqJLP5xcnTy8fjk7DSKExBAvr29Xa/XzaEByMvlsm5jlpV5Xgt2SIhjUT+2Vlfrje8KmTeR0TDwP48Mct2nNC2zrCa/k6UqzVbra6RU1VjgRtWc7r/cA47wfEDuUBI6DnoriuJ0NtMx938DiBzH92PzFxlLYFoWFhFj2MzWN4GQ3yDHQYD2NzfSf8TXZBq53sWAcz0v/7/kQ0oiz8O+zueY2X8B5rwhF1lW9xlk/GKSjdf/gqZy7O1IU1vvpjJqthwHaX9t2CGsEgx7tTljLj3X97FuPCIfK/S2rH9ciyz7wpZQfj7XCdEpdQ0D1Tm6kSF1zw8tW7Ht1jOB7xo6FvNYU7+wj7p2SGY7ve5Or7crcO3x6DeOey/L+xNxTxBei6M/ARtdMELgznelAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"eql 2\"\n        title=\"\"\n        src=\"/static/37ce090fd37a26025b16943df9b87d01/b1cde/eql_2.png\"\n        srcset=\"/static/37ce090fd37a26025b16943df9b87d01/8ff5a/eql_2.png 240w,\n/static/37ce090fd37a26025b16943df9b87d01/e85cb/eql_2.png 480w,\n/static/37ce090fd37a26025b16943df9b87d01/b1cde/eql_2.png 537w\"\n        sizes=\"(max-width: 537px) 100vw, 537px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p><strong>iSCSI Software Adapter</strong></p>\n<p>If you don’t yet have an iSCSI software adapter now is the time to add one in, once you have done that select it and press Properties. Under Network Configuration and press Add, select the two adapters you just configured (EQL<em>1 and EQL</em>2).</p>\n<p>While you are here also add in your EqualLogic’s group IP address in to the Dynamic Discovery tab</p>\n<p><strong>Setup VMware Round Robin</strong></p>\n<p>The next steps I have documented in the post <a href=\"https://samperrin.com/vmware/dell-mem-v1-2-and-esxi-5-5-u2/\" title=\"Dell MEM v1.2 and ESXi 5.5 U2\">Dell MEM v1.2 and ESXi 5.5 U2</a>, so I wont cover them again here. These steps setup cover the remaining recommendations from Dell.</p>\n<p><strong>Testing Failover</strong></p>\n<p>To confirm the above settings I did the followings tests to confirm failover – during these tests you should not have all paths down.<br>\nThese tests make the assumption that you have at least two switches, two network adapters and two controllers in your EqualLogic, and that you return to default before running the next test.</p>\n<ul>\n<li>Remove a network cable from the host (which connects to the storage network)</li>\n<li>Remove the other network cable</li>\n<li>Power off 1 switch</li>\n<li>Power off other switch</li>\n<li>Disconnect controller</li>\n<li>Disconnect other controller</li>\n</ul>\n<p>If you do encounter an APD scenario double-check your cabling, as per this diagram from Dell, a long with the heartbeat adapter the cabling also caused a problem. This was resolved with the help of this diagram.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/13d418a768d4d03de2b58c8a277c1f1a/6c2f2/ps4100-cabling.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 767px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 102.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAABYlAAAWJQFJUiTwAAAEXElEQVQ4y2VTaVPiWBTlX86nqZ7uqqmembZ7tLvaFdlCSAgQJCiiEFBBXLHH6VbbFRVQRBaVTWgRF1CQJSEgBmSZRK2pqZpbp25uvTon77573uMEw7FwOBJ6wmk0dhY/Pw6eMlUoFA49LV1eXno8Xrvd4XTu7bsOmMQULpe7Uqlw9l2er9+W19Y3v6+uMTkYiuw6DzY2tmzbO5ubNkZynrgc0Rt7+7gIItMZjEIhAACgyTxZq9U4IzpciihUKgxTYUNDGo1mmMsXfu7qbm/vaG//+P7Dn4f7+wY5/POrNwolNjesfvPL6z4ub3VtvdVqcXAcn5w0D06MD89aDfM2LW5BYVBtMJtxi3FAZzWZnfsHkwZcAklVmNpiwFFUiSCK5eUVVkxV6Os8lchR8RyVuCsnstRd8f4kXU7Gk4Fdb6tcqtRqzCAikUg0Ggs/zeLk5CQajbLio5vSQjC7HSc2zwrP2PiRX48TvqOzU4e3VSoxpEaj8fgU1WqtQBD5ApMIVnx4XQymyyyj2XqJJltV05lKMFynqH9X/h8c1yVxmMjR5XKBpMgigxJJFouleyJ+nj30kjdpqnxPFal8gbhJpdK36btsLpPJEATZbDY5mHWTqzYCgn6xRAJCkEAkAECQJxJpQImB268QA2IpImAIg0auyiAAYYVCyUx7x+6o1xsc89wiBMuUMKSSyzGFAoUhTCZTwLAJRWcRmX5AqRrRS3UW7SA2OGYRakw9fczf4UAgWK/XOZVgqPBtmbDZ8xvbLLZ20hu2zIYt63TlPb4KWczR9UCmXK3XK9XqVanuD4TPzy9ezmwfxc08nlAgQIQADIjlfP6UBJ4AQDMDsWRaOTCl1ujU+ilUaVJikuEJGaqGpQrXgZttewE3IgIBAIFSRCqRy1ARoBXDQqEYFkMSAISEgFSqBBVaDJZMQ3C/dLCXJ+LxAY/Xx7ZNPz7eP9APD3SNpjNl2u2NHR/F/OmyP0n6k8WjVPHwirwoVB7qj0T4NHKdf6ixhjefzOM8e/hsZIZuXp5dt3LZJ29rrRaDRwaNBlO06Hg8dkPWmyz7Rdx8uRfsN1tlxFct4p7O7WW3fkpt/ZrZeX27/ark/r3RqDzEL34w4v9ekvRNMplKXVxcpVPJRL4c9kWoRCp94Txf/SO00n663hlbene9wy0U7krhcCBxS1ClQiFPkiTTPGdmQj+gHhKKAEgCzi85zCMLs9246u2CpWN8rE0/0rk81IcaoKkZ7ZJ/YQ7VT6LYYE9Pn3ZklH3Pb397x7zyz51dfD5/0fr9i2bmKzRu5Vn+Bsx/8ScWwdkZMTwvHV4atS5IZe97QRBGOjo+ocoBdmexWILI5B87PnVx+1dM1kWZDkdmce60WWQ28saMwNw4gs9g819Gl3VaU7dsmOG3tX2QyRU0TXPch56j4xOHY29n1x7wBY7dIZczurcePrDH3PYfLlt03xFwO0/druj2gc/jP/b7j2y2ba/Pz7T9D1FTttsA5mYbAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"ps4100 cabling\"\n        title=\"\"\n        src=\"/static/13d418a768d4d03de2b58c8a277c1f1a/6c2f2/ps4100-cabling.png\"\n        srcset=\"/static/13d418a768d4d03de2b58c8a277c1f1a/8ff5a/ps4100-cabling.png 240w,\n/static/13d418a768d4d03de2b58c8a277c1f1a/e85cb/ps4100-cabling.png 480w,\n/static/13d418a768d4d03de2b58c8a277c1f1a/6c2f2/ps4100-cabling.png 767w\"\n        sizes=\"(max-width: 767px) 100vw, 767px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>","fields":{"tagSlugs":["/tags/vmware/"],"slug":"/posts/EqualLogic-PS4100-and-ESXi-5-5-VMkernel-Setup"},"frontmatter":{"title":"EqualLogic PS4100 and ESXi 5.5 VMkernel Setup","tags":["vmware"],"date":"2014-11-12T13:07:30.150Z","description":"iSCSI VMkernel setup for EqualLogic MEM on ESXi 5.5 U2"}}},"pageContext":{"slug":"/posts/EqualLogic-PS4100-and-ESXi-5-5-VMkernel-Setup"}}}