{"componentChunkName":"component---src-templates-post-template-jsx","path":"/posts/Dell-MEM-v1-2-and-ESXi-5-5-U2","result":{"data":{"site":{"siteMetadata":{"title":"Blog by Sam Perrin","subtitle":"Automation Consultant, currently working at Xtravirt. Interested in all things automation/devops related.","copyright":"¬© All rights reserved.","author":{"name":"Sam Perrin","twitter":"sam_perrin"},"disqusShortname":"","url":"https://samperrin.netlify.com"}},"markdownRemark":{"id":"7a2d469d-5e99-5cd8-940f-7af00994e369","html":"<p>It would seem that the Dell MEM v1.2 will not install on ESXi 5.5 U2 using esxcli. It can apparently be deployed using vMA or VUM but as these aren‚Äôt used we had to look for an alternative.</p>\n<p>The issue was with Dell who pointed us towards the following best practice document;<br>\n<a href=\"http://en.community.dell.com/cfs-file/__key/telligent-evolution-components-attachments/13-4491-00-00-20-43-46-01/TR1091-Best-Practices-with-EqualLogic-and-VMware-1.1.pdf?forcedownload=true\" title=\"TR1091-Best-Practices-with-EqualLogic-and-VMware-1.1.pdf\">http://en.community.dell.com/cfs-file/__key/telligent-evolution-components-attachments/13-4491-00-00-20-43-46-01/TR1091-Best-Practices-with-EqualLogic-and-VMware-1.1.pdf?forcedownload=true</a></p>\n<p>In summary they recommend the following.<br>\n‚Äì Use Round Robin<br>\n‚Äì Change from 1000 IO‚Äôs per path to 3 IO‚Äôs per path<br>\n‚Äì Change iSCSI Timeout values from default to 60 seconds<br>\n‚Äì Disable Delayed ACK</p>\n<p>Dell have provided some handy scripts to get you started, here they are for ESXi 5.x (they can all be found in the PDF attached earlier in the post so please refer to this for full details);</p>\n<p>Set all EqualLogic volumes to Round Robin and set IOPS value to 3 ‚Äì this must be run on all hosts;</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">esxcli storage nmp satp set --default-psp=VMW_PSP_RR --satp=VMW_SATP_EQL ; for i in `esxcli storage nmp device list | grep EQLOGIC|awk &#39;{print $7}&#39;|sed &#39;s/(//g&#39;|sed &#39;s/)//g&#39;` ; do esxcli storage nmp device set -d $i --psp=VMW_PSP_RR ; esxcli storage nmp psp roundrobin deviceconfig set -d $i -I 3 -t iops ; done</code></pre></div>\n<p>Set a default so that new EQL volumes will inherit the correct settings;</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">esxcli storage nmp satp rule add -s &quot;VMW_SATP_EQL&quot; -V &quot;EQLOGIC&quot; -M &quot;100E-00&quot; -P &quot;VMW_PSP_RR&quot; -O &quot;iops=3&quot;</code></pre></div>\n<p>The above command will require a restart of the host before it becomes effective, once you have restarted you can verify the correct settings using the below;</p>\n<p><code>esxcli storage nmp device list</code></p>\n<p>The output will be similar to what is shown below, the parts in bold are what you are looking for;</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">naa.6090a098703e5059e3e2e483c401f002\nDevice Display Name: EQLOGIC iSCSI Disk\n(naa.6090a098703e5059e3e2e483c401f002) \nStorage Array Type: VMW_SATP_EQL\nStorage Array Type Device Config: SATP VMW_SATP_EQL does not support device configuration. \nPath Selection Policy: VMW_PSP_RR\nPath Selection Policy Device Config: {policy=iops,iops=3,bytes=10485760,useANO=0;lastPathIndex=3: NumIOsPending=0,numBytesPending=0}</code></pre></div>\n<p><strong>VMW<em>SATP</em>EQL</strong> (indicates its an EqualLogic)</p>\n<p><strong>VMW<em>PSP</em>RR</strong> (path selection is set to Round Robin)</p>\n<p><strong>policy=iops,iops=3</strong> (shows IOPS have been set to 3)</p>\n<p>Next up is to change the default iSCSI timeout values. ‚ÄúBy default, the MEM configuration script will make an attempt to set each of these timeout values to 60 seconds which is the recommendation.‚Äù, so we will copy that with the below;</p>\n<p><code>esxcli iscsi adapter param set --adapter=vmhba## --key=LoginTimeout --value=60</code></p>\n<p>Replace ## with that of your iSCSI software adapter, for example vmhba33.</p>\n<p>After you have done the above you will need to disable Delayed ACK, Dell don‚Äôt provide a command line for disabling this, so it needs to be done through the vCentre GUI ‚Äì please refer to Page 10 in the PDF for steps on how to do this.</p>\n<p>Dell do list a few other recommendations, around such things as LRO and SIOC but I have not applied these so I wont go in to detail on what they mention.</p>\n<p>Hopefully this post will come in handy for a few people, as I know it held us back a bit!</p>\n<p><strong>Please check the commands before you apply them and also work with your vendor if you are unsure of the implications of changes some of the settings listed above will have towards other storage arrays, etc. üôÇ</strong></p>\n<p>I will soon be posting about the VMkernel/NIC setup for this, as we have had some issues relating to that too ‚Äì events such as APD! I will update this post with a link to that once it is ready</p>\n<p>UPDATE: Post relating to iSCSI setup is here! (to be updated)</p>","fields":{"tagSlugs":["/tags/vmware/"],"slug":"/posts/Dell-MEM-v1-2-and-ESXi-5-5-U2"},"frontmatter":{"title":"Dell MEM v1.2 and ESXi 5.5 U2","tags":["vmware"],"date":"2014-11-04T12:58:30.150Z","description":"Install Dell MEM v1.2 on ESXi 5.5 U2 using esxcli"}}},"pageContext":{"slug":"/posts/Dell-MEM-v1-2-and-ESXi-5-5-U2"}}}